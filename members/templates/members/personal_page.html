{% extends 'home/base.html' %}
{% block content %}
    <header>
        <title>Personal Page</title>
    </header>

    <body>
        <center>
            {% if user.is_authenticated %}
                {% if page_obj.paginator.count == 0 %}
                    {% if view.kwargs.username == user.username %}
                        <p style="color: rgb(255, 255, 255);">You did'nt post anything yet !</p>
                        <a style="color: rgb(255, 255, 255);" class="btn btn-dark" href="{% url 'create_post' %}">New Post</a>
                        <br>
                    {%else%}
                        <p style="color: rgb(255, 255, 255);">This user did'nt post anything yet !</p>
                    {% endif %}
                {% else %}
                    {% for post in posts %}
                        {% if forloop.counter <= 1 %} 
                            <div class="card bg-dark" style="width: 48rem;">
                                <center>
                                    <br>
                                    {% if post.author.userprofile.profile_image %}
                                        <img class="rounded-circle article-img" src="{{post.author.userprofile.profile_image.url}}" width="140" height="140">
                                    {% else %}
                                        <img class="rounded-circle article-img" src="/media/default.png" width="140" height="140">
                                    {% endif %}
                                </center>
                                <div class="card-body">
                                <h5 style="color: rgb(255, 255, 255);" class="card-title"><a href="{% url 'personal_page' post.author %}">@{{post.author}}</a> </h5>
                                <p style="color: rgb(255, 255, 255);" class="card-text">{{post.author.userprofile.bio}}</p>
                                </div>
                                <ul class="list-group list-group-flush">
                                    <br>
                                    <p style="color: rgb(255, 255, 255);" class="card-text">Name : {{post.author.first_name}} {{post.author.last_name}} </p>
                                    <p style="color: rgb(255, 255, 255);" class="card-text">Joined at : {{post.author.date_joined|date:"F d, Y"}} ({{post.author.userprofile.get_created_at_date}})</p>
                                    <br>
                                </ul>
                            </div>
                        {% endif %}
                    {% endfor %}
                    <br>
                    <h4 style="color: rgb(255, 255, 255);" class="mb-3">Total Posts : {{page_obj.paginator.count}}</h4>
                    <hr style="background-color: rgb(255, 255, 255);">
                    {% for post in posts %}
                            <div class="card bg-dark" style="width: 37rem;">
                                <div class="media content-section bg-dark" style="width: 36rem;">
                                    {% if post.author.userprofile.profile_image %}
                                        <img class="rounded-circle article-img" src="{{post.author.userprofile.profile_image.url}}" width="64" height="64">
                                    {% else %}
                                        <img class="rounded-circle article-img" src="/media/default.png" width="64" height="64">
                                    {% endif %}                                      <small style="color: rgb(52, 58, 64);">_</small>
                                    <small style="color: rgb(255, 255, 255);">{{post.author.first_name}} {{post.author.last_name}} <a href="{% url 'personal_page' post.author %}">@{{post.author}}</a> <small class="text-muted">{{post.created_at|date:"F d, Y"}} ({{post.get_created_at_date}})</small></small>
                                    {% if post.is_edited %}
                                        <small style="color: rgb(52, 58, 64);">_</small>
                                        <small><small><small class="text-muted"> edited({{post.get_edit_date}})</small></small></small>
                                    {% endif %}
                                </div>
                                <p class="card-text" style="color: rgb(255, 255, 255);">{{post.text}}</p>
                                {% if post.author == user %}
                                    <small>
                                        <a class="nav-link active dropdown-toggle" role="button" data-toggle="dropdown" aria-expanded="false">
                                        more
                                        </a>
                                        <div class="dropdown-menu bg-dark">
                                            <a class="dropdown-item bg-dark" style="color: rgb(23, 162, 184);" href="{% url 'post_edit_view' post.id %}">Edit</a>
                                            <a class="dropdown-item bg-dark" style="color: rgb(220, 53, 69);" href="{% url 'post_delete_view' post.id %}">Delete</a>
                                        </div>
                                    </small>
                                {% else %}
                                    <br>
                                {% endif %}
                            </div>
                            <br>
                    {% endfor %}
                    {% if is_paginated %}

                        {% if page_obj.has_previous %}
                            <a class="btn btn-outline-info mb-4" href="?page=1">&laquoFirst page</a>
                            <a class="btn btn-outline-info mb-4" href="?page={{ page_obj.previous_page_number }}">&laquoPrevious</a>
                        {% endif %}

                        {% for num in page_obj.paginator.page_range %}
                            {% if page_obj.number == num %}
                                <a class="btn btn-info mb-4" href="?page={{ num }}">{{ num }}</a>
                            {% elif num > page_obj.number|add:'-3' and  num < page_obj.number|add:'3' %}
                                <a class="btn btn-outline-info mb-4" href="?page={{ num }}">{{ num }}</a>
                            {% endif %}
                        {% endfor %}

                        {% if page_obj.has_next %}
                            <a class="btn btn-outline-info mb-4" href="?page={{ page_obj.next_page_number }}">Next&raquo</a>
                            <a class="btn btn-outline-info mb-4" href="?page={{ page_obj.paginator.num_pages }}">Last page&raquo</a>
                        {% endif %}

                    {% endif %}
                {% endif %}
            {% else %}
                <h1 style="color: rgb(255, 255, 255);"><a class="card-link" href="{%url 'login'%}">Login</a> to see this page</h1>
            {% endif %}
        </center>
    </body>
{% endblock %}